<!DOCTYPE html>
<html lang="{{ currentSite.language }}">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		{# SEOmatic meta tags #}
		{% if seomatic is defined %}
			{% if smartLink.seo is defined and smartLink.seo %}
				{# Use SEOmatic field data if available, with Smart Link fallbacks #}
				{% set seoData = smartLink.seo.metaGlobalVars %}
				{% do seomatic.meta.seoTitle(seoData.seoTitle ?: (smartLink.title ~ ' - QR Code')) %}
				{% do seomatic.meta.seoDescription(seoData.seoDescription ?: smartLink.description) %}
				{% if seoData.seoKeywords %}{% do seomatic.meta.seoKeywords(seoData.seoKeywords) %}{% endif %}
				{% do seomatic.meta.canonicalUrl(seoData.canonicalUrl ?: siteUrl('qr/' ~ smartLink.slug ~ '/view')) %}
				{% if seoData.robots %}{% do seomatic.meta.robots(seoData.robots) %}{% endif %}
				{% if seoData.seoImage %}{% do seomatic.meta.seoImage(seoData.seoImage) %}{% endif %}
				{% if seoData.ogType %}{% do seomatic.meta.ogType(seoData.ogType) %}{% endif %}
				{% do seomatic.meta.ogTitle(seoData.ogTitle ?: (smartLink.title ~ ' - QR Code')) %}
				{% do seomatic.meta.ogDescription(seoData.ogDescription ?: smartLink.description) %}
				{% if seoData.ogImage %}{% do seomatic.meta.ogImage(seoData.ogImage) %}{% endif %}
				{% if seoData.twitterCard %}{% do seomatic.meta.twitterCard(seoData.twitterCard) %}{% endif %}
				{% do seomatic.meta.twitterTitle(seoData.twitterTitle ?: (smartLink.title ~ ' - QR Code')) %}
				{% do seomatic.meta.twitterDescription(seoData.twitterDescription ?: smartLink.description) %}
				{% if seoData.twitterImage %}{% do seomatic.meta.twitterImage(seoData.twitterImage) %}{% endif %}
			{% else %}
				{# Fallback to Smart Link data #}
				{% do seomatic.meta.seoTitle(smartLink.title ~ ' - QR Code') %}
				{% do seomatic.meta.seoDescription(smartLink.description) %}
				{% do seomatic.meta.canonicalUrl(siteUrl('qr/' ~ smartLink.slug ~ '/view')) %}
			{% endif %}
		{% else %}
			{# Fallback meta tags if SEOmatic is not installed #}
			<title>{{ smartLink.title }} - QR Code - {{ siteName }}</title>
			{% if smartLink.description %}<meta name="description" content="{{ smartLink.description }}">{% endif %}
			<link rel="canonical" href="{{ siteUrl('qr/' ~ smartLink.slug ~ '/view') }}">
		{% endif %}

		<script src="https://cdn.tailwindcss.com"></script>

		{# Include SEOmatic tracking - this pushes events to GTM dataLayer #}
		{% set seomaticTracking = null %}
		{% if smartLink.renderSeomaticTracking is defined %}
			{% set seomaticTracking = smartLink.renderSeomaticTracking('qr_scan') %}
			{{ seomaticTracking }}
		{% endif %}
	</head>
	<body>
		<div class="flex justify-center items-center min-h-screen max-w-lg mx-auto px-4 py-8">
			{# Main container #}
			<div class="bg-white shadow-lg max-w-lg w-full overflow-hidden">
				<div class="p-8 md:p-12 text-center">
					{# Title #}
					<h1 class="text-3xl font-semibold mb-4 text-brand {% if smartLink.hideTitle %} sr-only{% endif %}">{{ smartLink.title }}</h1>

				{# Description #}
				{% if smartLink.description %}
					<p class="text-gray-600 mb-8 leading-relaxed">{{ smartLink.description }}</p>
				{% endif %}

				{# QR Code display #}
				<div class="my-8 mx-auto">
					<img src="{{ smartLink.getQrCodeUrl({ size: size ?? 300 }) }}" alt="{{ smartLink.title }} QR Code" class="mx-auto">
				</div>

				{# Instructions #}
				<div class="mt-8 space-y-4">
					<p class="text-sm text-gray-600">{{ 'Scan with your phone\'s camera to download'|t('smartlink-manager') }}</p>

					{# Download button #}
					<div class="mt-6 hidden">
						<a href="{{ smartLink.getQrCodeUrl({ download: 1, format: format, size: size }) }}" download="{{ smartLink.slug }}-qr.{{ format }}" class="inline-block px-6 py-3 bg-gray-100 text-gray-700 no-underline rounded-lg font-medium text-sm transition-all duration-200 hover:bg-gray-200">
							{{ "Download QR Code"|t('smartlink-manager') }}
						</a>
					</div>
				</div>

				</div>
		</div>
	</div>

	{# Debug mode - Add ?debug=1 to URL to see SEOmatic tracking details #}
	{# TODO: Remove before plugin store release #}
	<script>
		(function() {
			// Get debug mode from URL parameter
			var urlParams = new URLSearchParams(window.location.search);
			var debugMode = urlParams.get('debug') === '1';

			if (debugMode) {
				console.log('üêõ DEBUG MODE ENABLED');
				console.log('üîó Smart Link Slug:', {{ smartLink.slug|json_encode|raw }});
				console.log('üìä Event Type:', 'qr_scan');
				console.log('üì± QR Code Page');

				// SEOmatic tracking debug
				console.log('\nüì° SEOmatic Integration:');
				{% if seomaticTracking %}
					console.log('‚úÖ SEOmatic tracking enabled');
					console.log('üìù Tracking script rendered (see page source for details)');

					// Check if dataLayer exists
					if (typeof window.dataLayer !== 'undefined') {
						console.log('‚úÖ GTM dataLayer detected:', window.dataLayer);
					} else {
						console.log('‚ö†Ô∏è GTM dataLayer not found (SEOmatic may not be configured)');
					}
				{% else %}
					console.log('‚ùå SEOmatic tracking not available');
					console.log('   - Plugin may not be installed/enabled');
					console.log('   - Or integration may be disabled in settings');
				{% endif %}

				// Add debug indicator to page
				var debugBanner = document.createElement('div');
				debugBanner.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; background: #ff6b6b; color: white; padding: 10px; text-align: center; font-weight: bold; z-index: 9999;';
				debugBanner.textContent = 'üêõ DEBUG MODE - QR Code Page - Check browser console for details';
				document.body.insertBefore(debugBanner, document.body.firstChild);
			}
		})();
	</script>

</body>
</html>
